# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|

  config.vm.box = "digital_ocean"
  config.vm.box_url = "https://github.com/devopsgroup-io/vagrant-digitalocean/raw/master/box/digital_ocean.box"
  config.nfs.functional = false

  config.ssh.private_key_path = ENV['DO_PRIVATE_KEY_PATH']

  config.vm.provider :digital_ocean do |provider|
    provider.token = ENV['DO_TOKEN']
    provider.region = ENV['DO_REGION']
    provider.ssh_key_name = 'liquid-vagrant-sshkey'
    provider.image = 'ubuntu-18-04-x64'
    provider.size = 'g-2vcpu-8gb'
  end

  config.vm.synced_folder "..", "/opt/node", type: "rsync",
    rsync__exclude: [".vagrant/", ".git/", "__pycache__/",
                     "liquid.ini", "venv/", "volumes/", "collections/"]

  config.vm.provision :shell, path: "provision-do.sh"
  config.vm.provision :shell, path: "provision-cluster.sh"
  config.vm.provision :shell, path: "provision-liquid.sh"

end
