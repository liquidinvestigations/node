# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|

  config.vm.box = "digital_ocean"
  config.vm.box_url = "https://github.com/devopsgroup-io/vagrant-digitalocean/raw/master/box/digital_ocean.box"
  config.nfs.functional = false

  build_name = ENV['TRAVIS_JOB_NUMBER'] or 'default'
  config.vm.define build_name

  config.ssh.private_key_path = 'id_rsa'

  config.vm.provider :digital_ocean do |provider|
    provider.token = ENV['DO_TOKEN']
    provider.region = ENV['DO_REGION']
    provider.ssh_key_name = 'travis'
    provider.image = 'ubuntu-18-04-x64'
    provider.size = 's-4vcpu-8gb'
  end

  config.vm.synced_folder "..", "/opt/node", type: "rsync",
    rsync__exclude: [".vagrant/", ".git/", "__pycache__/",
                     "liquid.ini", "venv/", "volumes/", "collections/"]

  config.vm.provision :shell, path: "provision-do.sh"
  config.vm.provision :shell, path: "provision-cluster.sh"
  config.vm.provision :shell, path: "provision-liquid.sh"

end
