#!/bin/bash -e

echo "Vagrant"
VAGRANT_VERSION=2.2.4
(set -x
  curl -OL https://releases.hashicorp.com/vagrant/${VAGRANT_VERSION}/vagrant_${VAGRANT_VERSION}_x86_64.deb
  sudo dpkg -i vagrant_${VAGRANT_VERSION}_x86_64.deb
  vagrant plugin install vagrant-digitalocean
)

echo "Decrypting private ssh key"
# travis encrypt-file liquid-vagrant-sshkey
export DO_PRIVATE_KEY_PATH=liquid-vagrant-sshkey
(set -x
  openssl aes-256-cbc -K $encrypted_45612634ba13_key -iv $encrypted_45612634ba13_iv -in $DO_PRIVATE_KEY_PATH.enc -out $DO_PRIVATE_KEY_PATH -d
  chmod 600 $DO_PRIVATE_KEY_PATH
  ssh-keygen -e -f $DO_PRIVATE_KEY_PATH > $DO_PRIVATE_KEY_PATH.pub
)

echo "Running Vagrant"
# travis encrypt DO_TOKEN="$DO_TOKEN" DO_REGION="$DO_REGION" --add
(set -x
  vagrant up
)
